<!DOCTYPE HTML><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><script type="text/javascript" src="../jm/jquery-1.11.1.min.js"></script><script type="text/javascript" src="../jm/jquery.mobile-1.4.3.min.js"></script><link rel="stylesheet" href="../jm/jquery.mobile-1.4.3.min.css" /><script type="text/javascript" charset="utf-8" src="../js/core.js" ></script><script type="text/javascript" charset="utf-8" src="../js/page.js" ></script><script type="text/javascript" src="../js/lineChart.js"></script><link rel="stylesheet" href="../css/page.css" /><link rel="stylesheet" href="../css/core.css" /><script type="text/javascript" src="http://cdn.hcharts.cn/jquery/jquery-1.8.3.min.js"></script><script src="http://cdn.hcharts.cn/highcharts/highcharts.js"></script><script src="http://cdn.hcharts.cn/highcharts/modules/exporting.js"></script><style type="text/css">${demo.css}.hightchar_css{	min-width: 300px; 	height: 260px; 	margin-top:10px;	margin: 0 auto}</style><script type="text/javascript">	var allWater = new Array(); //所有浇灌机数据	var currentWater ;//当前操作的浇灌机 	var componentIds = "";	var isShowPic = false; //判断是否已显示图片	var dev_uuid = getQueryString("dev_uuid");	var shedinfo = "";	$(document).ready(function(){		var temp =IP+"/api/smartgates/";		var url = temp+ dev_uuid + "/infos";		var session_token = window.localStorage.session_token;		var  Authorization = "bearer " + session_token;		$.ajax({				type: "GET",		        url: url,  				success: getUserInfoSuccess,				error: getUserInfoError,       			headers: {           				"Authorization":Authorization       				}			});				});	//	function refresh() {		getCustomAlarmStrategies();	}	function getShedStrategy() {		var temp =IP+"/api/users/smartgates/";		var url = temp+ dev_uuid + "/alarmstrategy_settings/";		var session_token = window.localStorage.session_token;		var  Authorization = "bearer " + session_token;		$.ajax({				type: "GET",		        url: url,  				success: getShedStrategySuccess,				error: getShedStrategyError,       			headers: {           				"Authorization":Authorization       				}			});	}		function getShedStrategyError(data,status){		alert("操作失败!");	}		function getShedStrategySuccess(data,status){		addShedStrategy(data);	}	var CustomAlarmStrategies;	function getCustomAlarmStrategies() {		//CustomAlarmStrategies =  new Array();		var url = IP+"/api/users/custom_alarmstrategies/";		var session_token = window.localStorage.session_token;		var  Authorization = "bearer " + session_token;		$.ajax({				type: "GET",		        url: url,  				success: getCustomAlarmStrategiesSuccess,				error: getCustomAlarmStrategiesError,       			headers: {           				"Authorization":Authorization       				}			});	}		function getCustomAlarmStrategiesError(data,status){		alert("操作失败!");	}		function getCustomAlarmStrategiesSuccess(data,status){		CustomAlarmStrategies = data;		addShedStrategyItems(data);	}	function select_strategy(data){		var s=document.getElementById("shedstrategy_list");		var index = s.selectedIndex;		if(index ==0){			document.getElementById("alarmlist").innerHTML = "";		}else{			var selectIndex = index -1;			addShedStrategy(CustomAlarmStrategies[selectIndex]);		}	}	function addShedStrategyItems(data) {		var select_dev = document.getElementById("alram_setting_spinner");		var html = "<select id='shedstrategy_list' style='width: 100%;height:35px;' onchange='javascript:select_strategy(\""+data+"\");'> ";		html=html+ "<option selected='true'>"+"未定义"+"</option>";		for(var i=0;i<data.length;i++){			if(i==0){				html=html+ "<option value='"+i+"'>"+data[i].strategy_name+"</option>";			}else{				html=html+ "<option value='"+i+"'>"+data[i].strategy_name+"</option>";			}		}		html = html+" </select>";		select_dev.innerHTML = html;	}	function addShedStrategy(strategy) {		document.getElementById("alarmlist").innerHTML = "";		var charge_config  = strategy.charge_config;		//var jsonText = JSON.stringify(charge_config);		//alert(jsonText);		var temp ="";		if(charge_config != "" && charge_config != undefined 		      && charge_config != "undefined")			{				var title = "电量报警门限设置 ";				var h_title = "低电量";				var l_title = "低电量";				var unit = "%";				var img = "../images/alarm_battery.png"				var str = adddd(title,h_title,l_title,unit,charge_config,img,false);				temp =temp+"<tr>"+str +"</tr>";			}			//alert(temp);		var air_temperature_config = strategy.air_temperature_config;		if(air_temperature_config != "" && 			air_temperature_config != undefined 			&& air_temperature_config != "undefined")			{				var title = "空气温度报警门限设置 ";				var h_title = "高温";				var l_title =　"低温";				var unit = "C";				var img = "../images/alarm_air_t.png"				var str = adddd(title,h_title,l_title,unit,air_temperature_config,img,false);				temp =temp+"<tr>"+str +"</tr>";			}			//alert(temp);					var air_humidity_config = strategy.air_humidity_config;		if(air_humidity_config != "" && 			air_humidity_config != undefined 			&& air_humidity_config != "undefined")			{				var title = "空气湿度报警门限设置 ";				var h_title = "高湿度";				var l_title =　"低湿度";				var unit = "RH";				var img = "../images/alarm_air_h.png"				var str = adddd(title,h_title,l_title,unit,air_humidity_config,img,false);				temp =temp+"<tr>"+str +"</tr>";			}			//alert(temp);		var lux_config = strategy.lux_config;		if(lux_config != "" && 			lux_config != undefined 			&& lux_config != "undefined")			{				var title = "光照报警门限设置 ";				var h_title = "高光照强度";				var l_title =　"低光照强度";				var unit = "lux";				var img = "../images/alarm_lux.png"				var str = adddd(title,h_title,l_title,unit,lux_config,img,true);				temp =temp+"<tr>"+str +"</tr>";			}			//alert(temp);		var str1 = 	"<table style='width: 100%;margin-right: 10px;margin-top: 8px;margin_bottom:10px; '>"					+temp+"</table>";		document.getElementById("alarmlist").innerHTML = str1;	}		function adddd(title,h_title,l_title,unit,config,img,is_charge_config) {		var h_value_1 = config.h_value_1;		var h_value_2 = config.h_value_2;		var h_value_3 = config.h_value_3;		var l_value_1 = config.l_value_1;		var l_value_2 = config.l_value_2;		var l_value_3 = config.l_value_3;		var h_value_str = "";		if(h_value_1 != "" && h_value_1 != undefined && h_value_1 != "undefined"){			h_value_str = h_value_str+ "<ul>"				  +"<li class='li_line_height'>1级  " +h_value_1+unit+"</li>";		}		if(h_value_2 != "" && h_value_2 != undefined && h_value_2 != "undefined"){			h_value_str = h_value_str				  +"<li class='li_line_height'>2级  " +h_value_2+unit+"</li>";		}		if(h_value_3 != "" && h_value_3 != undefined && h_value_3 != "undefined"){			h_value_str = h_value_str				  +"<li class='li_line_height'>3级  " +h_value_3+unit+"</li>";		}		if(h_value_str != "" && h_value_str != undefined && h_value_str != "undefined")		{			h_value_str = h_value_str+"</ul>";		}		var column = "2";		if(h_value_1 != "" && h_value_1 != undefined && h_value_1 != "undefined" &&		l_value_1 != "" && l_value_1 != undefined && l_value_1 != "undefined")			column = "2";		else			column = "2";		//低温的值		var l_value_str = "";		if(l_value_1 != "" && l_value_1 != undefined && l_value_1 != "undefined"){			l_value_str = l_value_str+ "<ul>"				  +"<li class='li_line_height'>1级  " +l_value_1+unit+"</li>";		}		if(l_value_2 != "" && l_value_2 != undefined && l_value_2 != "undefined"){			l_value_str = l_value_str				  +"<li class='li_line_height'>2级  " +l_value_2+unit+"</li>";		}		if(l_value_3 != "" && l_value_3 != undefined && l_value_3 != "undefined"){			l_value_str = l_value_str				  +"<li class='li_line_height'>3级  " +l_value_3+unit+"</li>";		}		if(l_value_str != "" && l_value_str != undefined && l_value_str != "undefined")		{			l_value_str = l_value_str+"</ul>";		}		var str = "";		str =str+ "<table width='100%' border='0' cellspacing='0' cellpadding='0'>"		  +"<tr>"		    +"<td colspan='3' style='text-align: top;height:45px;'>"+title+"</td>"		  +"</tr>";		 if(l_value_str != "" && l_value_str != undefined && l_value_str != "undefined")		 {		 str = str			  +"<tr>"			    +"<td  style='width: 100px;' rowspan='"+column+"' valign='top'><img  src='"+img+"' class='component-icon'/></td>"			    +"<td valign='top' style='width: 100px;'>"+l_title			    +"</td>"			     +"<td>"			    	+l_value_str			    +"</td>"			  +"</tr>";		  }		  if(h_value_str != "" && h_value_str != undefined && h_value_str != "undefined")		  {		  if(is_charge_config)		  {		  	str = str			  +"<tr>"			    +"<td  style='width: 100px;' rowspan='"+column+"' valign='top'><img  src='"+img+"' class='component-icon'/></td>"			    +"<td valign='top' style='width: 100px;'>"+h_title			    +"</td>"			     +"<td>"			    	+h_value_str			    +"</td>"			  +"</tr>";		  }else{			 str = str +"<tr>"				    +"<td valign='top' style='width: 100px;'>"+h_title				    +"</td>"				     +"<td>"				    	+h_value_str				    +"</td>"				  +"</tr>";				  }		  }		str = str+"</table>";		//alert(str);		return str;	}	function updateAlias(componentId,index){		var name = "nickname"+index;		var alias  = document.getElementById(name).value;		var session_token = window.localStorage.session_token;		var  Authorization = "bearer " + session_token;		var url = IP+"/api/enddevices/"+componentId+"/alias";		var checkData = {component_id:componentId,alias:alias};		$.ajax({			type: "put",	        url: url,  			data: checkData,			success: updateAliasSuccess,			error: updateAliasError,   			headers: {       				"Authorization":Authorization   				}		});	}	function updateAlias1(){		var alias  = document.getElementById("dev_name_new").value;		var session_token = window.localStorage.session_token;		var  Authorization = "bearer " + session_token;		var url = IP+"/api/smartgates/"+dev_uuid+"/alias";		var checkData = {dev_uuid:dev_uuid,alias:alias};		$.ajax({			type: "put",			dataType: 'json',	        url: url,  			data: checkData,			success: updateAliasSuccess,			error: updateAliasError,   			headers: {       				"Authorization":Authorization   				}		});	}		//灌溉机操作	function opeErelay(dev_uuid,componentId,action){		//action：1为打开，0为关闭		//alert(componentId);		currentWater = componentId;		var session_token = window.localStorage.session_token;		var  Authorization = "bearer " + session_token;		var url = IP + "/api/remotes/erelays/actions";		var cmd = "set_eralay_switch";		var ccp_token = "ccp_token-smartgate-20150201";		var params = {cmd:cmd,status:action,sn:componentId};		var checkData = {ccp_token:ccp_token,smartgate_sn:dev_uuid,params:params};		var aToStr=JSON.stringify(checkData);		//alert(aToStr);		$.ajax({			type: "post",	        url: url,  	        dataType: 'json',			data: checkData,			success: opeErelaySuccess,			error: opeErelayError,   			headers: {       				"Authorization":Authorization   				}		});	}		function opeErelayError(data,status){		//var aToStr=JSON.stringify(data);		//alert(aToStr);		alert("操作失败!");	}		function opeErelaySuccess(data,status){		for(var i=0;i<allWater.length;i++){			var water = allWater[i];		 	if(water.name==currentWater){				var status= water.status;								if(status=="0"){					allWater[i].status = "online";									}else if(status=="online"){					allWater[i].status = "0";				}				status = allWater[i].status;				var stateJson = getState(status,status);				var tip = "btn_component_tip"+currentWater				var tipDiv = document.getElementById(tip);				tipDiv.innerHTML ="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+ stateJson.text;				var img1 = "1_btn_component"+currentWater;				 var bigimg = document.getElementById(img1); 				bigimg.src= stateJson.btn_icon;//改变灌溉机的状态图片与提示文字							} 		}		var aToStr=JSON.stringify(data);		//alert(aToStr);		//alert("操作成功!");	}		//卷帘机操作	function opeErelay2(dev_uuid,componentId,action){		var session_token = window.localStorage.session_token;		var  Authorization = "bearer " + session_token;		var url = IP + "/api/remotes/erelays/actions/";		var cmd = "set_eralay2_switch";		var ccp_token = "ccp_token-smartgate-20150201";		var params = {cmd:cmd,action:action,sn:componentId};		var checkData = {ccp_token:ccp_token,smartgate_sn:dev_uuid,params:params};		var aToStr=JSON.stringify(checkData);		//alert(aToStr);		$.ajax({			type: "post",	        url: url,  	        dataType: 'json',			data: checkData,			success: opeErelay2Success,			error: opeErelay2Error,   			headers: {       				"Authorization":Authorization   				}		});	}		function opeErelay2Error(data,status){		//var aToStr=JSON.stringify(data);		//alert(aToStr);		alert("操作失败!");	}		function opeErelay2Success(data,status){		//var aToStr=JSON.stringify(data);		//alert(aToStr);		alert("操作成功!");	}		function updateAliasError(data,status){		alert("更新失败!");	}		function updateAliasSuccess(data,status){		alert("更新成功!");	}	function getAnalysisResult(sn,device_type,scope) {		type_info = device_type;		var url_fix = IP+"/api/analyses/histories?"		var datess = getDate();		var url =url_fix+"sn="+sn		  		+"&device_type="+device_type		  		+"&date="+datess		  		+"&scope="+scope;		$.ajax({				type: "GET",		        url: url,  				success: getAnalysisResultSuccess,				error: getAnalysisResultError			});	} 	function getDate(){ 		var today=new Date();  		var years=today.getFullYear();  		var months=today.getMonth()+1;  		var d=today.getDate();		var h=today.getHours();		var m=today.getMinutes(); 		var s=today.getSeconds();		var dates = "["+years+"-"+months+"-"+d+"%2000:00:00,"+years+"-"+months+"-"+d+"%20"+h+":"+m+":"+s+"]"; 		return dates; 	}	function getAnalysisResultSuccess(deviceData,status){		showCanvas(deviceData,type_info);	 }	function getAnalysisResultError(deviceData,status){	 	alert("失败，可能是网络不通");	}	function getUserInfoSuccess(deviceData,status){		 shedinfo = deviceData;		 document.getElementById("title").innerHTML = deviceData.smartgate.dev_name;		 document.getElementById("common_plant_name").innerHTML = deviceData.smartgate.plant_name;		 var plant_time = deviceData.smartgate.plant_time;		 var plant_timeStr = plant_time.substring(0,4)+"年"+plant_time.substring(4,6)+"月"+plant_time.substring(6,8)+"日";		 document.getElementById("common_plant_time").innerHTML = plant_timeStr;		 document.getElementById("common_area").innerHTML = deviceData.smartgate.area + "平方米";		 var harvest_time = deviceData.smartgate.harvest_time;		 var harvest_timeStr = harvest_time.substring(0,4)+"年"+harvest_time.substring(4,6)+"月"+harvest_time.substring(6,8)+"日";		 document.getElementById("common_harvest_time").innerHTML = harvest_timeStr;		 document.getElementById("common_expectation").innerHTML = deviceData.smartgate.expectation + "公斤";		 document.getElementById("common_sn").innerHTML = deviceData.smartgate.sn;		 document.getElementById("common_location").innerHTML = deviceData.smartgate.dev_location;		 show(deviceData);	}		function getUserInfoError(data,status){	    alert("失败，可能是网络不通");	}		function getDeviceInfoSuccess(data,status){	    show(data);	}		function getDeviceInfoError(data,status){	    alert("失败，可能是网络不通");	}		function back()	{		window.history.go(-1);	}	function changeTab(index,num){		for(var i=1;i<=num;i++) {			if(i==index) {				document.getElementById("part"+i).style.display = "block";				$("#tab"+i).addClass("curr");			} else {				document.getElementById("part"+i).style.display = "none";				$("#tab"+i).removeClass("curr");			}		}	}	function changeSettingTab(index,num){		for(var i=1;i<=num;i++) {			if(i==index) {				document.getElementById("part2"+i).style.display = "block";				$("#settingtab"+i).addClass("curr");			} else {				$("#settingtab"+i).removeClass("curr");				document.getElementById("part2"+i).style.display = "none";			}			if(index == 2){				getCustomAlarmStrategies();			}		}	}	function showPart2() {		var dev_name = shedinfo.smartgate.dev_name;		var dev_alias = shedinfo.smartgate.dev_alias;		document.getElementById("dev_name").innerHTML = dev_name;		if(dev_alias == "undefined")		  dev_alias = dev_name;		document.getElementById("dev_name_new").value= dev_alias;			}	function show(deviceData){		showPart2();		addSetting();		var components = deviceData.components;		if(components.length>0){			var cgqArr = new Array(); // 传感器设备数据			for(var j=0; j<components.length; j++){				//componentIds = componentIds + "," + components[j].component_id;				var device_div = document.createElement("div");				device_div.className = "component";				var stateJson = getState(components[j].online_state,components[j].online_state);				/*if(components[j].dev_type=="cameraip"){  // 监视器					device_div.innerHTML = "<div class='detail'><div class='left'>"						+ "<img src='"+getComponentIcon(components[j].dev_type,components[j].online_state)+"' class='component-icon'/>"						+ "<div>"+components[j].dev_name+"</div></div>"						+ "<div class='right'><div>"+stateJson.text+"</div>"						+ "<img src='"+stateJson.icon+"' class='status-icon'/></div></div>"						+ "<div class='cameraipDiv'><img src='../images/video.png' class='background'/>"						+ "<div><a href='javascript:pageUtil.remoteMonitoring(\""+components[j].sn+"\",\""+components[j].user+"\",\""+components[j].password+"\")'>"						+ "<img src='../images/video_icon.png' /></a></div></div>";										document.getElementById("cameraip").appendChild(device_div);									} else */if(components[j].dev_type=="erelay") {  // 灌溉机				var snStr = "sn:"+components[j].sn;				 var myDate = new Date();				 var month =myDate.getMonth()+1;				 var timeStr = "更新时间:"+myDate.getFullYear()+"年"+month+"月"+myDate.getDate()+"日"				 				+myDate.getHours()+":"+myDate.getMinutes()+":"+myDate.getSeconds();				  // alert(timeStr);				var str = "<div class='detail' style='height:65px;'>"								+"<div class='left' >"									+ "<img src='../images/category1.png' class='component-icon' />"									+"<table style='margin-top:-15px;margin-left:40px;'>"									 	+"<tr >"									 		+"<td >"+components[j].dev_name+"</td>"									 	+"</tr>"									 	+"<tr >"									 		+"<td><span style='font-size:12px'>"+snStr+"</span></td>"									 	+"</tr>"									 +"</table>"								+"</div>"		 						+ "<div class='right-shed' id='btn_component_tip1'"+components[j].sn+"' >"										+"<table style='margin-top:-15px;cellspacing:0px;'>"									 	+"<tr style='line-height:30px;'>"									 		+"<td style='text-align:right;height:30px;'>"				 								//+ "<a 'id='1_a_component"+components[j].sn+"' href='javascript:opeErelay(\""+dev_uuid+"\",\""+components[j].sn+"\",\"1\")'>"				 									+ "<img id='1_btn_component"+components[j].sn+"' src='"+stateJson.btn_icon+"' class='operation-icon' onclick='javascript:opeErelay(\""+dev_uuid+"\",\""+components[j].sn+"\",\"1\")'/>"												//+"</a>"												+"<span  id='btn_component_tip"+components[j].sn+"' >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;关闭</span>"													+"<img src='../images/time.png' class='time-icon'/>"																							+"</td>"									 	+"</tr>"									 	+"<tr style='line-height:30px;'>"									 		+"<td ><span style='font-size:9px;color: red;'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+timeStr+"</span></td>"									 	+"</tr>"									 +"</table>"									+"</div>"						+"</div>";											device_div.innerHTML = str;					var item = {name:components[j].sn,status:"0"};//					allWater.push(item);					document.getElementById("erelay").appendChild(device_div);				} else if(components[j].dev_type=="erelay2") {  // 卷帘机				   var dev_name=components[j].dev_name;				   var snStr = "sn:"+components[j].sn;				  //var time1 = new Date().format("yyyy-MM-dd HH:mm:ss");				 var myDate = new Date();				 var month =myDate.getMonth()+1;				 var timeStr = "更新时间:"+myDate.getFullYear()+"年"+month+"月"+myDate.getDate()+"日"				 				+myDate.getHours()+":"+myDate.getMinutes()+":"+myDate.getSeconds();				  // alert(timeStr);				   if(dev_name=="双向控制" ||dev_name=='')				      dev_name = getDefaultNameByExtendType(components[j].dev_extend_type);										var htmlstr= "<div class='detail' style='height:65px;'>"									+"<div class='left'>" 										+ "<img src='../images/category2.png' class='component-icon'/>"										+"<table style='margin-top:-5px;'>"										 	+"<tr >"										 		+"<td >"+dev_name+"</td>"										 	+"</tr>"										 	+"<tr >"										 		+"<td><span style='font-size:12px'>"+snStr+"</span></td>"										 	+"</tr>"										 +"</table>"									+"</div>"			 						+ "<div class='right-shed'>"			 							+"<table style='margin-top:-5px;'>"									 	+"<tr >"									 		+"<td style='text-align:right;align:right;'>"					 							+ "<a href='javascript:opeErelay2(\""+dev_uuid+"\",\""+components[j].sn+"\",\"back\")'>"					 							+ "<img src='../images/forward1.png' class='forward1'/></a>"												+ "<a href='javascript:opeErelay2(\""+dev_uuid+"\",\""+components[j].sn+"\",\"1\")'>"												+ "<img src='../images/forward2.png' class='forward2'/></a>"												+ "<a href='javascript:opeErelay2(\""+dev_uuid+"\",\""+components[j].sn+"\",\"forward\")'>"												+ "<img src='../images/forward3.png' class='forward3'/></a>"											+"</td>"									 	+"</tr>"									 	+"<tr >"									 		+"<td style='text-align:right;align:right;'><span style='font-size:9px;color: red;' id='updatetime'>"+timeStr+"</span></td>"									 	+"</tr>"									 +"</table>"									+"</div>"								+"</div>";					device_div.innerHTML =htmlstr;					document.getElementById("erelay").appendChild(device_div);				} /*else if(components[j].dev_type=="camera") {  //照相机					device_div.innerHTML = "<div class='detail'><div class='left'>"						+ "<img src='"+getComponentIcon(components[j].dev_type,components[j].online_state)+"' class='component-icon'/>"						+ "<div>"+components[j].default_alias+"</div></div>"						+ "<div class='right'><div>"+stateJson.text+"</div>"						+ "<img src='"+stateJson.icon+"' class='status-icon'/></div></div>"						+ "<div class='cameraPic' id='imgDiv"+components[j].component_id+"' style='width:100%'></div>";											document.getElementById("picComponents").appendChild(device_div);				} */else if(components[j].dev_type=="humidity-temperature" || components[j].dev_type=="illumination" ){					cgqArr.push(components[j]);				}								// pageUtil.getAlarmList(devUuid,components[j].component_id,24,1,1,components[j].default_alias);			}			if(componentIds!=""){				componentIds = componentIds.substring(1);			}			showCgq(cgqArr);		}	}			function closeResult(msg,flag,componentId){		if(msg=="ok"){			messageBox("操作成功！");			if(flag=="1"){				document.getElementById("1_btn_component"+componentId).src = "images/button_close.png";				document.getElementById("1_a_component"+componentId).disabled=true;			}		} else {			messageBox("操作失败！");		}	}			function opeResult(msg,flag,componentId){		if(msg=="ok"){			messageBox("操作成功！");		} else {			messageBox("操作失败！");		}	}	var components ;	function add_select(arr) {		components = arr;		var select_dev = document.getElementById("select_names");		var html = "<select id='select_dev' style='width: 100%;height:35px;' onchange='gradeChange();'> ";		for(var i=0;i<arr.length;i++){			if(i==0){				html=html+ "<option value='"+i+"' selected='true'>"+arr[i].dev_name+"</option>";			}else{				html=html+ "<option value='"+i+"'>"+arr[i].dev_name+"</option>";			}		}		html = html+" </select>";		select_dev.innerHTML = html;	}	function gradeChange() {		var obj=document.getElementById('select_dev');  		var index=obj.selectedIndex; //序号，取当前选中选项的序号  		var val = obj.options[index].value;  		getAnalysisResult(components[index].sn,components[index].dev_type,"scope2");//sn,device_type,scope	}	var type_info = "";	// 显示传感器信息	function showCgq(arr){		if(arr==null||arr.length==0){			document.getElementById("cgq-div").style.display = "none";			return;		}		add_select(arr);		var jsonText = JSON.stringify(arr);		//alert(jsonText);		 var myDate = new Date();		 var month =myDate.getMonth()+1;		 var timeStr = "更新时间:"+myDate.getFullYear()+"年"+month+"月"+myDate.getDate()+"日"		 				+myDate.getHours()+":"+myDate.getMinutes()+":"+myDate.getSeconds();		var chartsn = document.getElementById("chartsn");		var charttime = document.getElementById("charttime");		chartsn.innerHTML = "sn:"+arr[0].sn;		charttime.innerHTML = timeStr;		//chartsn charttime		getAnalysisResult(arr[0].sn,arr[0].dev_type,"scope2");//sn,device_type,scope	}			function addSetting() {		var components = shedinfo.components;		var str = "";		for(var i=0; i<components.length; i++){			var component = components[i];			var alias = component.dev_alias;			if(alias == "" || alias == undefined || alias == "undefined")			    alias = component.dev_name;			 str = str +"<tr >"			    +"<td style='width: 50px;'><img  src='../images/house.png' class='component-icon'/></td>"			    +"<td style='margin-left: 10px; width=100%'><div style='text-align:left;'><span id='dev_name' style='text-align:left;'>"+component.dev_name+"</span></div></td>"			    +"<td ></td>"			 +"</tr>"			     +"<tr >"			     	+"<td ></td>"			    +"<td ><input  id='nickname"+i+"' type='text' style='line-height:30px;' value='"+alias+"' /></td>"			    +"<td  class='settingtd2' ><a href='javascript:updateAlias(\""+component.sn+"\","+i+")'><img src='../images/button5.png' /><div>修改</div></a></td>"			 +"</tr>"		}		var str1 = 	"<table style='width: 100%;margin-right: 10px;margin-top: 8px; '>"					+str+"</table>";		document.getElementById("settings").innerHTML = str1;	}	// 显示Canvas图	function showCanvas(jsonData,type){		if(type!="illumination"){			var str = "<div id='char1' class='hightchar_css'></div>"				+"<div id='char2' class='hightchar_css'></div>";				document.getElementById("hightchars").innerHTML = str;		}else{		var str = "<div id='char1' class='hightchar_css'></div>";				document.getElementById("hightchars").innerHTML = str;		}		var result = jsonData.result;		var object = jsonData.msg;		var data = object.data;		var air_temperature = data.air_temperature;		var air_humidity = data.air_humidity;		if(result == "OK"){			if(type=="humidity-temperature"){				if(!(air_temperature == "" || air_temperature == undefined || air_temperature == "undefined")){					var valueArr = new Array();					var times = new Array();					times = formatTimes(air_temperature);					valueArr = formatDatas(air_temperature);					canvasChar("char1",times,"空气温度",valueArr, '#90ed7d',100,0,'℃',false);				}				if(!(air_humidity == "" || air_humidity == undefined || air_humidity == "undefined")){					var valueArr = new Array();					var times = new Array();					times = formatTimes(air_humidity);					valueArr = formatDatas(air_humidity);					canvasChar("char2",times,"空气湿度",valueArr,'#8085e8',100,0,'RH',false);				}			}else if(type=="illumination"){				var lux = data.lux;				if(!(lux == "" || lux == undefined || lux == "undefined")){					var valueArr = new Array();					var times = new Array();					times = formatTimes(lux);					valueArr = formatDatas(lux);					canvasChar("char1",times,"光照",valueArr,'#7cb5ec',4000,0,'k lx',true);				}						}		}	}	function formatTimes(datas) {		var times = new Array();		for(var i=0; i<datas.length; i++){			var valueObj = datas[i];			var time = valueObj.time;			var d =new Date(time); 			var dates = formatDate(d);//1:00			times.push(dates);		}		return times;	}	function formatDatas(datas) {		var valueArr = new Array();		for(var i=0; i<datas.length; i++){			var valueObj = datas[i];			var value = valueObj.value;//3			valueArr.push(value);		}		return valueArr;	}	function canvasChar(name,times,title,valueArr,clor,max_v,min_v,Units,is_lux) {	var plotLines = 1;	if(is_lux){		plotLines =(max_v-min_v)/4;	}		$(function () {			var options = {			        chart: {			            type: 'line',			            zoomType: 'x',			            renderTo:name			        },			        xAxis:{					   title:{					       text:null					   }					},					credits:{					     enabled:false // 禁用版权信息					},					yAxis:{					   title:{					       text:null					   },			        labels: {			                formatter: function() {			                    return this.value/plotLines +Units			                },			                enabled:true			            },					    max:max_v, // 定义Y轴 最大值                  		min:min_v, // 定义最小值 					 },				  exporting:					{						enabled:false // 导出功能不显示					 },			        title :{					    text:null					},					tooltip: {						shared: true, //是否共享提示，也就是X一样的所有点都显示出来						useHTML: true, //是否使用HTML编辑提示信息						headerFormat: '<small>{point.key}</small><table>',						pointFormat: '<tr><td style="color: {series.color}"> </td>' +						'<td style="text-align: right"><b>{point.y}</b></td></tr>',						footerFormat: '</table>',						valueDecimals: 2 //数据值保留小数位数						},			        xAxis: {			            categories: times			        },			        series: [{			            data: valueArr,			            color:clor,			            name: "",   						showInLegend: false // 设置为 false 即为不显示在图例中			        }]			    };			    //options.yAxis.plotLines=100;			    var chart = new Highcharts.Chart(options);			});	}</script><title>大棚</title> </head><body > <header data-role="header" data-theme="a" data-position="fixed"  data-tap-toggle="false" > 	<div class="top"> 		<div class="left" onclick="back();"><img style="width:13px;height:24px;" src="../images/item_grid_header_arrow_icon.png"/></div> 		<div class="center"><b id="title"></b></div> 	</div>	<div data-role="navbar" data-position="fixed" class="tab">		<ul>			<li id="tab1" class="curr" style="width: 50%;" onclick="javascript:changeTab(1,2)">详情</li>			<li id="tab2" style="width: 50%; " onclick="javascript:changeTab(2,2)">设置</li>		</ul>	</div> </header> <div class="content">	 	<div id="part1" style="display:block;">		 	<div class="components">		 		<div class="component">		 			<div class="plant">种值作物：<span id="common_plant_name">大豆</span></div>		 		</div>		 		<div class="component">		 			<div class="plant">种值时间：<span id="common_plant_time"></span></div>		 		</div>		 		<div class="component">		 			<div class="plant">种植面积：<span id="common_area"></span></div>		 		</div>		 		<div class="component">		 			<div class="plant">收获时间：<span id="common_harvest_time"></span></div>		 		</div>		 		<div class="component">		 			<div class="plant">预估产量：<span id="common_expectation"></span></div>		 		</div>		 		<div class="component">		 			<div class="plant">设备SN号：<span id="common_sn"></span></div>		 		</div>		 		<div class="component">		 			<div class="plant">大棚位置：<span id="common_location"></span></div>		 		</div>		 	</div>		 			 	<div id="cameraip" class="components">		 	</div>		 			 	<div id="erelay" class="components">		 	</div>		 			 	<div id="cgq-div" class="components">		 		<div class="component">			 		<div class="cgq">			 			<div id="select_names" style="margin-top: 8px;"　class="name"></div>			 			<div ><span style='font-size:9px;' id='chartsn'></span></div>			 			<div><span style='font-size:9px;color: red;' id='charttime'></span></div>						<div id="hightchars">						</div>					</div>				</div>		 	</div>		 </div>	 	 <div id="part2" style="display:none;margin-top: 8px;margin-left: 2px;margin-right: 2px;">	 	 	<div data-role="navbar" data-position="fixed" class="settingtab" >				<ul>					<li id="settingtab1" class="curr" style="width: 33%;" onclick="javascript:changeSettingTab(1,3)">别名设置</li>					<li id="settingtab2" style="width: 33%;" onclick="javascript:changeSettingTab(2,3)">报警预案设置</li>					<li id="settingtab3" style="width: 34%;" onclick="javascript:changeSettingTab(3,3)">其它设置</li>				</ul>			</div>			<div id="settingContent"> 			 	<div id="part21" class="component">				 	<div class='detail-2'>				 		<div style="width: 100%;margin-top: 10px;">					 		<div style='margin-top: 8px;'>					 			大棚别名设置							</div>						</div>						<table style='width: 100%;margin-right: 10px; margin-top: 8px;'>						  <tr >						    <td style='width: 50px;'><img  src='../images/house.png' class='component-icon'/></td>						    <td style='margin-left: 10px;'><div style='text-align:left;'><span id='dev_name' style='text-align:left;'></span></div></td>						    <td style='width:60px;'></td>						 </tr>	 				     <tr >	 				     	<td ></td>						    <td ><input id='dev_name_new' type='text' style='line-height:30px;' data-role="none" /></td>						   <td  class='settingtd2' ><a href='javascript:updateAlias1()'><img src='../images/button5.png' /><div>修改</div></a></td>						 </tr>						</table>					</div>					<div class='detail-2' id="settings">					</div>			 	</div>			 	<div id="part22" class="component" style="display:none;">						<table style="width: 100%;height:40px; margin-top: 10px;margin-left:10px;margin-right: 10px; ">						  <tr style="width: 100%;height:40px;">						    <td style="width: 70%;">报警预案</td>						    <td style="height:40px;">					 			<img style="width: 35px;height:35px; " src="../images/refresh.png" onclick="refresh();"/>							</td>						    <td style="height:40px;">					 			<img style="width: 35px;height:35px; " src="../images/apply.png"/>							</td>						  </tr>						</table>						<table style="width: 95%;margin-left:10px;margin-right: 10px; ">						  <tr >						    <td width="25%;">预案名称：</td>						    <td style="margin-right: 10px;">								<div id="alram_setting_spinner" style="margin-top: 8px;"　class="name"></div>							</td>						  </tr>						</table>						<div class='detail-2' id="alarmlist">						</div>			 	</div>		 		<div  id="part23" class="component" style="display:none;">		 			<div> </div>			 	</div>			</div>		 </div>	 </div></body></html>